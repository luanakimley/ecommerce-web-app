{"ast":null,"code":"var _jsxFileName = \"/Users/luanakimley/nodejs-projects/ecommerce-web-app/client/src/components/ProductForms/EditProduct.jsx\";\nimport React from \"react\";\nimport { Link, Redirect, withRouter } from \"react-router-dom\";\nimport { Form, Button, InputGroup } from \"react-bootstrap\";\nimport Swal from \"sweetalert2\";\nimport { XLg } from \"react-bootstrap-icons\";\nimport axios from \"axios\";\nimport { Trash } from \"react-bootstrap-icons\";\nimport { SERVER_HOST, CATEGORIES, COLOURS } from \"../../config/global_constants.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass EditProduct extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = e => {\n      this.setState({\n        [e.target.name]: e.target.value\n      });\n    };\n\n    this.handleFileChange = e => {\n      this.setState({\n        selectedFiles: e.target.files\n      });\n    };\n\n    this.addCategory = e => {\n      if (this.state.selectedCategory !== \"\" && !this.state.categories.includes(this.state.selectedCategory)) {\n        this.setState({\n          categories: [...this.state.categories, this.state.selectedCategory]\n        });\n      }\n    };\n\n    this.removeCategory = e => {\n      this.setState({\n        categories: this.state.categories.filter(g => g !== e.currentTarget.dataset.id)\n      });\n    };\n\n    this.addColour = e => {\n      if (this.state.selectedColours !== \"\" && !this.state.colours.includes(this.state.selectedColours)) {\n        this.setState({\n          colours: [...this.state.colours, this.state.selectedColours]\n        });\n      }\n    };\n\n    this.removeColour = e => {\n      this.setState({\n        colours: this.state.colours.filter(g => g !== e.currentTarget.dataset.id)\n      });\n    };\n\n    this.handleRemovePhoto = e => {\n      let formData = new FormData();\n      formData.append(\"productName\", this.state.productName);\n      formData.append(\"price\", this.state.price);\n      formData.append(\"description\", this.state.description);\n\n      for (let i = 0; i < this.state.categories.length; i++) {\n        formData.append(\"categories\", this.state.categories[i]);\n      }\n\n      formData.append(\"stock\", this.state.stock);\n\n      for (let i = 0; i < this.state.colours.length; i++) {\n        formData.append(\"colours\", this.state.colours[i]);\n      }\n\n      axios.put(`${SERVER_HOST}/products/photo/${this.state._id}/${e.currentTarget.dataset.id}`, {\n        headers: {\n          authorization: localStorage.token\n        }\n      });\n    };\n\n    this.handleSubmit = e => {\n      e.preventDefault();\n      axios.defaults.withCredentials = true;\n      let formData = new FormData();\n      formData.append(\"productName\", this.state.productName);\n      formData.append(\"price\", this.state.price);\n      formData.append(\"description\", this.state.description);\n\n      for (let i = 0; i < this.state.categories.length; i++) {\n        formData.append(\"categories\", this.state.categories[i]);\n      }\n\n      formData.append(\"stock\", this.state.stock);\n\n      for (let i = 0; i < this.state.colours.length; i++) {\n        formData.append(\"colours\", this.state.colours[i]);\n      }\n\n      if (this.state.selectedFiles !== null) {\n        for (let i = 0; i < this.state.selectedFiles.length; i++) {\n          formData.append(\"productPhotos\", this.state.selectedFiles[i]);\n        }\n      } else {\n        for (let i = 0; i < this.state.photos.length; i++) {\n          formData.append(\"productPhotos\", JSON.stringify(this.state.photos[i]));\n        }\n      }\n\n      axios.put(`${SERVER_HOST}/products/${this.props.match.params.id}`, formData, {\n        headers: {\n          authorization: localStorage.token\n        }\n      }).then(res => {\n        if (res.data) {\n          if (res.data.errorMessage) {\n            console.log(res.data.errorMessage);\n            Swal.fire({\n              title: \"Product not updated\",\n              text: res.data.errorMessage,\n              icon: \"error\",\n              confirmButtonColor: \"#123c69\",\n              showConfirmButton: true\n            });\n          } else {\n            console.log(\"Product updated\");\n            Swal.fire({\n              title: \"Product updated\",\n              text: \"The product details have been updated.\",\n              icon: \"success\",\n              showConfirmButton: false,\n              timer: 1500\n            });\n            this.setState({\n              redirectToHome: true\n            });\n          }\n        } else {\n          console.log(\"Product not updated\");\n          Swal.fire({\n            title: \"Product not updated\",\n            text: \"Make sure that data is valid.\",\n            icon: \"error\",\n            confirmButtonColor: \"#123c69\",\n            showConfirmButton: true\n          });\n        }\n      });\n    };\n\n    this.state = {\n      productName: \"\",\n      price: \"\",\n      _id: \"\",\n      description: \"\",\n      categories: [],\n      selectedCategory: \"\",\n      stock: \"\",\n      colours: [],\n      photos: [],\n      selectedColours: \"\",\n      selectedFiles: null,\n      redirectToHome: false\n    };\n  }\n\n  componentDidMount() {\n    axios.defaults.withCredentials = true;\n    axios.get(`${SERVER_HOST}/products/${this.props.match.params.id}`, {\n      headers: {\n        authorization: localStorage.token\n      }\n    }).then(res => {\n      if (res.data) {\n        if (res.data.errorMessage) {\n          console.log(res.data.errorMessage);\n        } else {\n          this.setState({\n            _id: res.data._id,\n            productName: res.data.productName,\n            price: res.data.price,\n            description: res.data.description,\n            categories: res.data.categories,\n            stock: res.data.stock,\n            colours: res.data.colours,\n            photos: res.data.photos\n          });\n          res.data.photos.map(photo => {\n            return axios.get(`${SERVER_HOST}/products/photo/${photo.filename}`).then(res => {\n              if (res.data) {\n                if (res.data.errorMessage) {\n                  console.log(res.data.errorMessage);\n                } else {\n                  document.getElementById(photo._id).src = `data:;base64,${res.data.image}`;\n                }\n              } else {\n                console.log(\"Record not found\");\n              }\n            });\n          });\n        }\n      } else {\n        console.log(`Product not found`);\n      }\n    });\n  }\n\n  validateProductName() {\n    return this.state.productName !== \"\";\n  }\n\n  validatePrice() {\n    return this.state.price > 0;\n  }\n\n  validateDescription() {\n    return this.state.description !== \"\";\n  }\n\n  validateCategories() {\n    return this.state.categories.length !== 0 && this.state.categories !== undefined;\n  }\n\n  validateStock() {\n    return this.state.stock >= 0;\n  }\n\n  validateColours() {\n    return this.state.colours.length !== 0 && this.state.colours !== undefined;\n  }\n\n  validate() {\n    return {\n      productName: this.validateProductName(),\n      price: this.validatePrice(),\n      description: this.validateDescription(),\n      categories: this.validateCategories(),\n      stock: this.validateStock(),\n      colours: this.validateColours()\n    };\n  }\n\n  render() {\n    console.log(JSON.stringify(this.state.photos[0]));\n    console.log(this.state.selectedFiles);\n    const formInputsState = this.validate();\n    const inputsAreAllValid = Object.keys(formInputsState).every(index => formInputsState[index]);\n    let productNameError = \"\";\n    let priceError = \"\";\n    let descriptionError = \"\";\n    let categoriesError = \"\";\n    let stockError = \"\";\n    let coloursError = \"\";\n\n    if (!this.validateProductName()) {\n      productNameError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Product name is required.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (!this.validateDescription()) {\n      descriptionError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Product description is required.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (!this.validatePrice()) {\n      priceError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Price must be a positive number.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (!this.validateCategories()) {\n      categoriesError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Choose at least 1 category.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (!this.validateStock()) {\n      stockError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Stock must be a positive number.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (!this.validateColours()) {\n      coloursError = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger mt-2\",\n        children: \"Choose at least 1 colour.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container p-3\",\n      children: [this.state.redirectToHome ? /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/shop\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 38\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card flex-column border-0 shadow rounded-3 overflow-hidden p-4 m-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \" text-center mt-3  \",\n          children: \"Edit Product\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-container m-4\",\n          children: /*#__PURE__*/_jsxDEV(Form, {\n            children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mt-2\",\n              controlId: \"productName\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Product Name\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 309,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"text\",\n                name: \"productName\",\n                value: this.state.productName,\n                onChange: this.handleChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 310,\n                columnNumber: 17\n              }, this), productNameError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mt-2\",\n              controlId: \"price\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Price\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"text\",\n                name: \"price\",\n                value: this.state.price,\n                onChange: this.handleChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 17\n              }, this), priceError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              controlId: \"description\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Description\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"text\",\n                name: \"description\",\n                as: \"textarea\",\n                value: this.state.description,\n                onChange: this.handleChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 17\n              }, this), descriptionError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mt-2\",\n              controlId: \"categories\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Categories\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(InputGroup, {\n                children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n                  name: \"selectedCategory\",\n                  as: \"select\",\n                  onChange: this.handleChange,\n                  defaultValue: \"DEFAULT\",\n                  children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"DEFAULT\",\n                    disabled: true,\n                    children: \"Select category...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 351,\n                    columnNumber: 21\n                  }, this), CATEGORIES.filter(g => !this.state.categories.includes(g)).map(g => /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: g,\n                    children: g.toUpperCase()\n                  }, g, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 357,\n                    columnNumber: 23\n                  }, this))]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 345,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outline-secondary\",\n                  onClick: this.addCategory,\n                  children: \"Add Category\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 363,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 344,\n                columnNumber: 17\n              }, this), this.state.categories.map(g => /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"badge badge-secondary p-1 mt-2 mr-2\",\n                children: [g.toUpperCase(), /*#__PURE__*/_jsxDEV(XLg, {\n                  \"data-id\": g,\n                  className: \"ml-1\",\n                  onClick: this.removeCategory\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 373,\n                  columnNumber: 21\n                }, this)]\n              }, g, true, {\n                fileName: _jsxFileName,\n                lineNumber: 371,\n                columnNumber: 19\n              }, this)), categoriesError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mt-2\",\n              controlId: \"stock\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Stock\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 384,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"text\",\n                name: \"stock\",\n                value: this.state.stock,\n                onChange: this.handleChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 385,\n                columnNumber: 17\n              }, this), stockError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              className: \"mt-2\",\n              controlId: \"colours\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Colours\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 395,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(InputGroup, {\n                children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n                  name: \"selectedColours\",\n                  as: \"select\",\n                  onChange: this.handleChange,\n                  defaultValue: \"DEFAULT\",\n                  children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"DEFAULT\",\n                    disabled: true,\n                    children: \"Select colour...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 403,\n                    columnNumber: 21\n                  }, this), Object.keys(COLOURS).filter(g => !this.state.colours.includes(g)).map(g => /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: g,\n                    children: g.toUpperCase()\n                  }, g, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 409,\n                    columnNumber: 25\n                  }, this))]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 397,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outline-secondary\",\n                  onClick: this.addColour,\n                  children: \"Add Colour\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 415,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 396,\n                columnNumber: 17\n              }, this), this.state.colours.map(g => /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"badge badge-secondary p-1 mt-2 mr-2\",\n                children: [g.toUpperCase(), /*#__PURE__*/_jsxDEV(XLg, {\n                  \"data-id\": g,\n                  className: \"ml-1\",\n                  onClick: this.removeColour\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 422,\n                  columnNumber: 21\n                }, this)]\n              }, g, true, {\n                fileName: _jsxFileName,\n                lineNumber: 420,\n                columnNumber: 19\n              }, this)), coloursError]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 394,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n              controlId: \"photos\",\n              className: \"mt-2\",\n              children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                children: \"Photos\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 432,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                type: \"file\",\n                multiple: true,\n                onChange: this.handleFileChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 433,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-flex\",\n                children: this.state.photos.map(photo => /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"d-flex flex-column\",\n                  children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                    className: \"rounded mt-3  mr-3 ml-0\",\n                    id: photo._id,\n                    width: \"200px\",\n                    alt: \"Product\"\n                  }, photo._id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 441,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    \"data-id\": photo._id,\n                    className: \"btn btn-secondary mr-3 mt-2\",\n                    onClick: this.handleRemovePhoto,\n                    children: \"Remove image\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 448,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 440,\n                  columnNumber: 21\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 438,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 431,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-success mt-3 mr-2\",\n              onClick: this.handleSubmit,\n              disabled: !inputsAreAllValid,\n              children: \"Edit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 462,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              to: \"/shop\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn btn-danger mt-3 ml-2\",\n                children: \"Cancel\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 471,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 470,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(EditProduct);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/luanakimley/nodejs-projects/ecommerce-web-app/client/src/components/ProductForms/EditProduct.jsx"],"names":["React","Link","Redirect","withRouter","Form","Button","InputGroup","Swal","XLg","axios","Trash","SERVER_HOST","CATEGORIES","COLOURS","EditProduct","Component","constructor","props","handleChange","e","setState","target","name","value","handleFileChange","selectedFiles","files","addCategory","state","selectedCategory","categories","includes","removeCategory","filter","g","currentTarget","dataset","id","addColour","selectedColours","colours","removeColour","handleRemovePhoto","formData","FormData","append","productName","price","description","i","length","stock","put","_id","headers","authorization","localStorage","token","handleSubmit","preventDefault","defaults","withCredentials","photos","JSON","stringify","match","params","then","res","data","errorMessage","console","log","fire","title","text","icon","confirmButtonColor","showConfirmButton","timer","redirectToHome","componentDidMount","get","map","photo","filename","document","getElementById","src","image","validateProductName","validatePrice","validateDescription","validateCategories","undefined","validateStock","validateColours","validate","render","formInputsState","inputsAreAllValid","Object","keys","every","index","productNameError","priceError","descriptionError","categoriesError","stockError","coloursError","toUpperCase"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Link, Redirect, withRouter } from \"react-router-dom\";\nimport { Form, Button, InputGroup } from \"react-bootstrap\";\nimport Swal from \"sweetalert2\";\nimport { XLg } from \"react-bootstrap-icons\";\nimport axios from \"axios\";\nimport { Trash } from \"react-bootstrap-icons\";\nimport {\n  SERVER_HOST,\n  CATEGORIES,\n  COLOURS,\n} from \"../../config/global_constants.js\";\n\nclass EditProduct extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      productName: \"\",\n      price: \"\",\n      _id: \"\",\n      description: \"\",\n      categories: [],\n      selectedCategory: \"\",\n      stock: \"\",\n      colours: [],\n      photos: [],\n      selectedColours: \"\",\n      selectedFiles: null,\n      redirectToHome: false,\n    };\n  }\n\n  componentDidMount() {\n    axios.defaults.withCredentials = true;\n\n    axios\n      .get(`${SERVER_HOST}/products/${this.props.match.params.id}`, {\n        headers: { authorization: localStorage.token },\n      })\n      .then((res) => {\n        if (res.data) {\n          if (res.data.errorMessage) {\n            console.log(res.data.errorMessage);\n          } else {\n            this.setState({\n              _id: res.data._id,\n              productName: res.data.productName,\n              price: res.data.price,\n              description: res.data.description,\n              categories: res.data.categories,\n              stock: res.data.stock,\n              colours: res.data.colours,\n              photos: res.data.photos,\n            });\n\n            res.data.photos.map((photo) => {\n              return axios\n                .get(`${SERVER_HOST}/products/photo/${photo.filename}`)\n                .then((res) => {\n                  if (res.data) {\n                    if (res.data.errorMessage) {\n                      console.log(res.data.errorMessage);\n                    } else {\n                      document.getElementById(\n                        photo._id\n                      ).src = `data:;base64,${res.data.image}`;\n                    }\n                  } else {\n                    console.log(\"Record not found\");\n                  }\n                });\n            });\n          }\n        } else {\n          console.log(`Product not found`);\n        }\n      });\n  }\n\n  handleChange = (e) => {\n    this.setState({ [e.target.name]: e.target.value });\n  };\n\n  handleFileChange = (e) => {\n    this.setState({ selectedFiles: e.target.files });\n  };\n\n  addCategory = (e) => {\n    if (\n      this.state.selectedCategory !== \"\" &&\n      !this.state.categories.includes(this.state.selectedCategory)\n    ) {\n      this.setState({\n        categories: [...this.state.categories, this.state.selectedCategory],\n      });\n    }\n  };\n\n  removeCategory = (e) => {\n    this.setState({\n      categories: this.state.categories.filter(\n        (g) => g !== e.currentTarget.dataset.id\n      ),\n    });\n  };\n\n  addColour = (e) => {\n    if (\n      this.state.selectedColours !== \"\" &&\n      !this.state.colours.includes(this.state.selectedColours)\n    ) {\n      this.setState({\n        colours: [...this.state.colours, this.state.selectedColours],\n      });\n    }\n  };\n\n  removeColour = (e) => {\n    this.setState({\n      colours: this.state.colours.filter(\n        (g) => g !== e.currentTarget.dataset.id\n      ),\n    });\n  };\n\n  handleRemovePhoto = (e) => {\n    let formData = new FormData();\n\n    formData.append(\"productName\", this.state.productName);\n    formData.append(\"price\", this.state.price);\n    formData.append(\"description\", this.state.description);\n    for (let i = 0; i < this.state.categories.length; i++) {\n      formData.append(\"categories\", this.state.categories[i]);\n    }\n    formData.append(\"stock\", this.state.stock);\n    for (let i = 0; i < this.state.colours.length; i++) {\n      formData.append(\"colours\", this.state.colours[i]);\n    }\n    \n\n    axios.put(\n      `${SERVER_HOST}/products/photo/${this.state._id}/${e.currentTarget.dataset.id}`,\n      {\n        headers: { authorization: localStorage.token },\n      }\n    );\n  };\n\n  handleSubmit = (e) => {\n    e.preventDefault();\n\n    axios.defaults.withCredentials = true;\n\n    let formData = new FormData();\n\n    formData.append(\"productName\", this.state.productName);\n    formData.append(\"price\", this.state.price);\n    formData.append(\"description\", this.state.description);\n    for (let i = 0; i < this.state.categories.length; i++) {\n      formData.append(\"categories\", this.state.categories[i]);\n    }\n    formData.append(\"stock\", this.state.stock);\n    for (let i = 0; i < this.state.colours.length; i++) {\n      formData.append(\"colours\", this.state.colours[i]);\n    }\n\n    if (this.state.selectedFiles !== null) {\n      for (let i = 0; i < this.state.selectedFiles.length; i++) {\n        formData.append(\"productPhotos\", this.state.selectedFiles[i]);\n      }\n    } else {\n      for (let i = 0; i < this.state.photos.length; i++) {\n        formData.append(\"productPhotos\", JSON.stringify(this.state.photos[i]));\n      }\n    }\n\n    axios\n      .put(`${SERVER_HOST}/products/${this.props.match.params.id}`, formData, {\n        headers: { authorization: localStorage.token },\n      })\n      .then((res) => {\n        if (res.data) {\n          if (res.data.errorMessage) {\n            console.log(res.data.errorMessage);\n            Swal.fire({\n              title: \"Product not updated\",\n              text: res.data.errorMessage,\n              icon: \"error\",\n              confirmButtonColor: \"#123c69\",\n              showConfirmButton: true,\n            });\n          } else {\n            console.log(\"Product updated\");\n            Swal.fire({\n              title: \"Product updated\",\n              text: \"The product details have been updated.\",\n              icon: \"success\",\n              showConfirmButton: false,\n              timer: 1500,\n            });\n            this.setState({ redirectToHome: true });\n          }\n        } else {\n          console.log(\"Product not updated\");\n          Swal.fire({\n            title: \"Product not updated\",\n            text: \"Make sure that data is valid.\",\n            icon: \"error\",\n            confirmButtonColor: \"#123c69\",\n            showConfirmButton: true,\n          });\n        }\n      });\n  };\n\n  validateProductName() {\n    return this.state.productName !== \"\";\n  }\n\n  validatePrice() {\n    return this.state.price > 0;\n  }\n\n  validateDescription() {\n    return this.state.description !== \"\";\n  }\n\n  validateCategories() {\n    return (\n      this.state.categories.length !== 0 && this.state.categories !== undefined\n    );\n  }\n\n  validateStock() {\n    return this.state.stock >= 0;\n  }\n\n  validateColours() {\n    return this.state.colours.length !== 0 && this.state.colours !== undefined;\n  }\n\n  validate() {\n    return {\n      productName: this.validateProductName(),\n      price: this.validatePrice(),\n      description: this.validateDescription(),\n      categories: this.validateCategories(),\n      stock: this.validateStock(),\n      colours: this.validateColours(),\n    };\n  }\n\n  render() {\n    console.log(JSON.stringify(this.state.photos[0]));\n    console.log(this.state.selectedFiles);\n\n    const formInputsState = this.validate();\n    const inputsAreAllValid = Object.keys(formInputsState).every(\n      (index) => formInputsState[index]\n    );\n\n    let productNameError = \"\";\n    let priceError = \"\";\n    let descriptionError = \"\";\n    let categoriesError = \"\";\n    let stockError = \"\";\n    let coloursError = \"\";\n\n    if (!this.validateProductName()) {\n      productNameError = (\n        <p className=\"text-danger mt-2\">Product name is required.</p>\n      );\n    }\n    if (!this.validateDescription()) {\n      descriptionError = (\n        <p className=\"text-danger mt-2\">Product description is required.</p>\n      );\n    }\n    if (!this.validatePrice()) {\n      priceError = (\n        <p className=\"text-danger mt-2\">Price must be a positive number.</p>\n      );\n    }\n    if (!this.validateCategories()) {\n      categoriesError = (\n        <p className=\"text-danger mt-2\">Choose at least 1 category.</p>\n      );\n    }\n    if (!this.validateStock()) {\n      stockError = (\n        <p className=\"text-danger mt-2\">Stock must be a positive number.</p>\n      );\n    }\n    if (!this.validateColours()) {\n      coloursError = (\n        <p className=\"text-danger mt-2\">Choose at least 1 colour.</p>\n      );\n    }\n\n    return (\n      <div className=\"container p-3\">\n        {this.state.redirectToHome ? <Redirect to=\"/shop\" /> : null}\n\n        <div className=\"card flex-column border-0 shadow rounded-3 overflow-hidden p-4 m-4\">\n          <h2 className=\" text-center mt-3  \">Edit Product</h2>\n          <div className=\"form-container m-4\">\n            <Form>\n              <Form.Group className=\"mt-2\" controlId=\"productName\">\n                <Form.Label>Product Name</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  name=\"productName\"\n                  value={this.state.productName}\n                  onChange={this.handleChange}\n                />\n                {productNameError}\n              </Form.Group>\n\n              <Form.Group className=\"mt-2\" controlId=\"price\">\n                <Form.Label>Price</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  name=\"price\"\n                  value={this.state.price}\n                  onChange={this.handleChange}\n                />\n                {priceError}\n              </Form.Group>\n\n              <Form.Group controlId=\"description\">\n                <Form.Label>Description</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  name=\"description\"\n                  as=\"textarea\"\n                  value={this.state.description}\n                  onChange={this.handleChange}\n                />\n                {descriptionError}\n              </Form.Group>\n\n              <Form.Group className=\"mt-2\" controlId=\"categories\">\n                <Form.Label>Categories</Form.Label>\n                <InputGroup>\n                  <Form.Control\n                    name=\"selectedCategory\"\n                    as=\"select\"\n                    onChange={this.handleChange}\n                    defaultValue={\"DEFAULT\"}\n                  >\n                    <option value=\"DEFAULT\" disabled>\n                      Select category...\n                    </option>\n                    {CATEGORIES.filter(\n                      (g) => !this.state.categories.includes(g)\n                    ).map((g) => (\n                      <option key={g} value={g}>\n                        {g.toUpperCase()}\n                      </option>\n                    ))}\n                  </Form.Control>\n\n                  <Button\n                    variant=\"outline-secondary\"\n                    onClick={this.addCategory}\n                  >\n                    Add Category\n                  </Button>\n                </InputGroup>\n                {this.state.categories.map((g) => (\n                  <span className=\"badge badge-secondary p-1 mt-2 mr-2\" key={g}>\n                    {g.toUpperCase()}\n                    <XLg\n                      data-id={g}\n                      className=\"ml-1\"\n                      onClick={this.removeCategory}\n                    />\n                  </span>\n                ))}\n                {categoriesError}\n              </Form.Group>\n\n              <Form.Group className=\"mt-2\" controlId=\"stock\">\n                <Form.Label>Stock</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  name=\"stock\"\n                  value={this.state.stock}\n                  onChange={this.handleChange}\n                />\n                {stockError}\n              </Form.Group>\n\n              <Form.Group className=\"mt-2\" controlId=\"colours\">\n                <Form.Label>Colours</Form.Label>\n                <InputGroup>\n                  <Form.Control\n                    name=\"selectedColours\"\n                    as=\"select\"\n                    onChange={this.handleChange}\n                    defaultValue={\"DEFAULT\"}\n                  >\n                    <option value=\"DEFAULT\" disabled>\n                      Select colour...\n                    </option>\n                    {Object.keys(COLOURS)\n                      .filter((g) => !this.state.colours.includes(g))\n                      .map((g) => (\n                        <option key={g} value={g}>\n                          {g.toUpperCase()}\n                        </option>\n                      ))}\n                  </Form.Control>\n\n                  <Button variant=\"outline-secondary\" onClick={this.addColour}>\n                    Add Colour\n                  </Button>\n                </InputGroup>\n                {this.state.colours.map((g) => (\n                  <span className=\"badge badge-secondary p-1 mt-2 mr-2\" key={g}>\n                    {g.toUpperCase()}\n                    <XLg\n                      data-id={g}\n                      className=\"ml-1\"\n                      onClick={this.removeColour}\n                    />\n                  </span>\n                ))}\n                {coloursError}\n              </Form.Group>\n              <Form.Group controlId=\"photos\" className=\"mt-2\">\n                <Form.Label>Photos</Form.Label>\n                <Form.Control\n                  type=\"file\"\n                  multiple\n                  onChange={this.handleFileChange}\n                />\n                <div className=\"d-flex\">\n                  {this.state.photos.map((photo) => (\n                    <div className=\"d-flex flex-column\">\n                      <img\n                        className=\"rounded mt-3  mr-3 ml-0\"\n                        key={photo._id}\n                        id={photo._id}\n                        width=\"200px\"\n                        alt=\"Product\"\n                      />\n                      <button\n                        data-id={photo._id}\n                        className=\"btn btn-secondary mr-3 mt-2\"\n                        onClick={this.handleRemovePhoto}\n                      >\n                        Remove image\n                      </button>\n                    </div>\n                  ))}\n                </div>\n              </Form.Group>\n\n              <br />\n\n              <button\n                className=\"btn btn-success mt-3 mr-2\"\n                onClick={this.handleSubmit}\n                disabled={!inputsAreAllValid}\n              >\n                Edit\n              </button>\n\n              <Link to={\"/shop\"}>\n                <button className=\"btn btn-danger mt-3 ml-2\">Cancel</button>\n              </Link>\n            </Form>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(EditProduct);\n"]},"metadata":{},"sourceType":"module"}