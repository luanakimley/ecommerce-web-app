{"ast":null,"code":"var _jsxFileName = \"/Users/luanakimley/nodejs-projects/ecommerce-web-app/client/src/pages/Shop.jsx\";\nimport React, { Component } from \"react\";\nimport ShopGrid from \"../components/ProductArea/ShopGrid\";\nimport ShopBanner from \"../components/ShopBanner\";\nimport SideBar from \"../components/ShopSideBar/SideBar\";\nimport axios from \"axios\";\nimport { SERVER_HOST } from \"../config/global_constants.js\";\nimport { Spinner } from \"react-bootstrap\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Shop extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getAllItems = e => {\n      let url = `${SERVER_HOST}/products?`;\n\n      if (this.state.sort === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n      } else if (this.state.sort === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n      } else if (this.state.sort === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n      } else if (this.state.sort === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n      }\n\n      axios.get(url).then(res => {\n        if (res.data) {\n          if (res.data.errorMessage) {\n            console.log(res.data.errorMessage);\n          } else {\n            console.log(\"Records read\");\n            this.setState({\n              products: res.data\n            });\n            this.setState({\n              category: \"all items\"\n            });\n            const maxPrice = Math.max.apply(Math, this.state.products.map(p => p.price));\n            const minPrice = Math.min.apply(Math, this.state.products.map(p => p.price));\n            this.setState({\n              minPrice: minPrice\n            });\n            this.setState({\n              maxPrice: maxPrice\n            });\n            this.setState({\n              value: [minPrice, maxPrice]\n            });\n            const productCategories = this.state.products.map(product => product.categories);\n            this.setState({\n              uniqueCategories: [...new Set(productCategories.flat(1))].sort()\n            });\n            const productColours = this.state.products.map(product => product.colours);\n            this.setState({\n              uniqueColours: [...new Set(productColours.flat(1))].sort()\n            });\n            this.setState({\n              loading: false\n            });\n          }\n        } else {\n          console.log(\"Record not found\");\n        }\n      });\n    };\n\n    this.handleCategoryFilter = e => {\n      let url = `${SERVER_HOST}/products?categories=${e.target.textContent.toLowerCase()}`;\n      this.setState({\n        category: e.target.textContent\n      });\n\n      if (this.state.sort === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n      } else if (this.state.sort === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n      } else if (this.state.sort === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n      } else if (this.state.sort === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n      }\n\n      this.fetchItems(url);\n    };\n\n    this.handlePriceFilter = (e, newVal) => {\n      this.setState({\n        value: newVal\n      });\n      let url = `${SERVER_HOST}/products?`;\n\n      if (this.state.category !== \"all items\") {\n        url += `categories=${this.state.category.toLowerCase()}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      } else {\n        url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      }\n\n      if (this.state.sort === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n      } else if (this.state.sort === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n      } else if (this.state.sort === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n      } else if (this.state.sort === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n      }\n\n      this.fetchItems(url);\n    };\n\n    this.handleColoursFilter = e => {\n      if (!this.state.colours.includes(e.target.textContent)) {\n        this.state.colours.push(e.target.textContent);\n      } else {\n        let index = this.state.colours.indexOf(e.target.textContent);\n        this.state.colours.splice(index, 1);\n      }\n\n      let url = `${SERVER_HOST}/products?`;\n\n      if (this.state.category !== \"all items\") {\n        url += `categories=${this.state.category.toLowerCase()}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      } else {\n        url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      }\n\n      if (this.state.sort === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n      } else if (this.state.sort === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n      } else if (this.state.sort === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n      } else if (this.state.sort === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n      }\n\n      this.fetchItems(url);\n    };\n\n    this.handleSearch = e => {\n      this.setState({\n        searchQuery: e.target.value\n      });\n      let url = `${SERVER_HOST}/products?`;\n\n      if (this.state.category !== \"all items\") {\n        url += `categories=${this.state.category.toLowerCase()}&q=${e.target.value}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      } else {\n        this.setState({\n          products: this.state.products.filter(product => product.productName.toLowerCase().includes(e.target.value))\n        });\n        url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      }\n\n      if (this.state.sort === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n      } else if (this.state.sort === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n      } else if (this.state.sort === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n      } else if (this.state.sort === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n      }\n\n      this.fetchItems(url);\n    };\n\n    this.handleSort = e => {\n      let url = `${SERVER_HOST}/products?`;\n\n      if (this.state.category !== \"all items\") {\n        url += `categories=${this.state.category.toLowerCase()}&productName=${this.state.searchQuery}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      } else {\n        url += `productName=${this.state.searchQuery}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n        this.state.colours.forEach(colour => {\n          url += `&colours=${colour}`;\n        });\n      }\n\n      if (e.target.value === \"nameAsc\") {\n        url += `&sortBy=productName&orderBy=1`;\n        this.setState({\n          sort: e.target.value\n        });\n      } else if (e.target.value === \"nameDesc\") {\n        url += `&sortBy=productName&orderBy=-1`;\n        this.setState({\n          sort: e.target.value\n        });\n      } else if (e.target.value === \"priceAsc\") {\n        url += `&sortBy=price&orderBy=1`;\n        this.setState({\n          sort: e.target.value\n        });\n      } else if (e.target.value === \"priceDesc\") {\n        url += `&sortBy=price&orderBy=-1`;\n        this.setState({\n          sort: e.target.value\n        });\n      } else if (e.target.value === \"\") {\n        this.setState({\n          sort: \"\"\n        });\n      }\n\n      this.fetchItems(url);\n    };\n\n    this.state = {\n      products: [],\n      category: \"all items\",\n      value: [],\n      minPrice: 1,\n      maxPrice: 100,\n      uniqueCategories: [],\n      colours: [],\n      uniqueColours: [],\n      searchQuery: \"\",\n      sort: \"\",\n      loading: true\n    };\n  }\n\n  componentDidMount() {\n    this.getAllItems();\n  }\n\n  fetchItems(url) {\n    axios.get(url).then(res => {\n      if (res.data) {\n        if (res.data.errorMessage) {\n          console.log(res.data.errorMessage);\n        } else {\n          console.log(\"Records read\");\n          this.setState({\n            products: res.data\n          });\n        }\n      } else {\n        console.log(\"Record not found\");\n      }\n    });\n  }\n\n  render() {\n    return this.state.loading ? /*#__PURE__*/_jsxDEV(Spinner, {\n      animation: \"border\",\n      role: \"status\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"visually-hidden\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      children: [/*#__PURE__*/_jsxDEV(ShopBanner, {\n        title: this.state.category\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(SideBar, {\n              onFilter: this.handleCategoryFilter,\n              getAllItems: this.getAllItems,\n              onPriceFilter: this.handlePriceFilter,\n              value: this.state.value,\n              minPrice: this.state.minPrice,\n              maxPrice: this.state.maxPrice,\n              curMinPrice: this.state.value[0],\n              curMaxPrice: this.state.value[1],\n              uniqueCategories: this.state.uniqueCategories,\n              onColourFilter: this.handleColoursFilter,\n              uniqueColours: this.state.uniqueColours,\n              colours: this.state.colours,\n              onSearch: this.handleSearch,\n              curCategory: this.state.category\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ShopGrid, {\n              products: this.state.products,\n              onSort: this.handleSort\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default Shop;","map":{"version":3,"sources":["/Users/luanakimley/nodejs-projects/ecommerce-web-app/client/src/pages/Shop.jsx"],"names":["React","Component","ShopGrid","ShopBanner","SideBar","axios","SERVER_HOST","Spinner","Shop","constructor","props","getAllItems","e","url","state","sort","get","then","res","data","errorMessage","console","log","setState","products","category","maxPrice","Math","max","apply","map","p","price","minPrice","min","value","productCategories","product","categories","uniqueCategories","Set","flat","productColours","colours","uniqueColours","loading","handleCategoryFilter","target","textContent","toLowerCase","fetchItems","handlePriceFilter","newVal","forEach","colour","handleColoursFilter","includes","push","index","indexOf","splice","handleSearch","searchQuery","filter","productName","handleSort","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ShopGrid from \"../components/ProductArea/ShopGrid\";\nimport ShopBanner from \"../components/ShopBanner\";\nimport SideBar from \"../components/ShopSideBar/SideBar\";\nimport axios from \"axios\";\nimport { SERVER_HOST } from \"../config/global_constants.js\";\nimport { Spinner } from \"react-bootstrap\";\n\nclass Shop extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      products: [],\n      category: \"all items\",\n      value: [],\n      minPrice: 1,\n      maxPrice: 100,\n      uniqueCategories: [],\n      colours: [],\n      uniqueColours: [],\n      searchQuery: \"\",\n      sort: \"\",\n      loading: true,\n    };\n  }\n\n  componentDidMount() {\n    this.getAllItems();\n  }\n\n  getAllItems = (e) => {\n    let url = `${SERVER_HOST}/products?`;\n\n    if (this.state.sort === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n    } else if (this.state.sort === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n    } else if (this.state.sort === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n    } else if (this.state.sort === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n    }\n\n    axios.get(url).then((res) => {\n      if (res.data) {\n        if (res.data.errorMessage) {\n          console.log(res.data.errorMessage);\n        } else {\n          console.log(\"Records read\");\n          this.setState({ products: res.data });\n          this.setState({ category: \"all items\" });\n          const maxPrice = Math.max.apply(\n            Math,\n            this.state.products.map((p) => p.price)\n          );\n          const minPrice = Math.min.apply(\n            Math,\n            this.state.products.map((p) => p.price)\n          );\n\n          this.setState({ minPrice: minPrice });\n          this.setState({ maxPrice: maxPrice });\n          this.setState({ value: [minPrice, maxPrice] });\n\n          const productCategories = this.state.products.map(\n            (product) => product.categories\n          );\n\n          this.setState({\n            uniqueCategories: [...new Set(productCategories.flat(1))].sort(),\n          });\n\n          const productColours = this.state.products.map(\n            (product) => product.colours\n          );\n\n          this.setState({\n            uniqueColours: [...new Set(productColours.flat(1))].sort(),\n          });\n\n          this.setState({ loading: false });\n        }\n      } else {\n        console.log(\"Record not found\");\n      }\n    });\n  };\n\n  fetchItems(url) {\n    axios.get(url).then((res) => {\n      if (res.data) {\n        if (res.data.errorMessage) {\n          console.log(res.data.errorMessage);\n        } else {\n          console.log(\"Records read\");\n          this.setState({\n            products: res.data,\n          });\n        }\n      } else {\n        console.log(\"Record not found\");\n      }\n    });\n  }\n\n  handleCategoryFilter = (e) => {\n    let url = `${SERVER_HOST}/products?categories=${e.target.textContent.toLowerCase()}`;\n\n    this.setState({ category: e.target.textContent });\n\n    if (this.state.sort === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n    } else if (this.state.sort === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n    } else if (this.state.sort === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n    } else if (this.state.sort === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n    }\n\n    this.fetchItems(url);\n  };\n\n  handlePriceFilter = (e, newVal) => {\n    this.setState({ value: newVal });\n\n    let url = `${SERVER_HOST}/products?`;\n    if (this.state.category !== \"all items\") {\n      url += `categories=${this.state.category.toLowerCase()}&minprice=${\n        this.state.value[0]\n      }&maxprice=${this.state.value[1]}`;\n\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    } else {\n      url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    }\n\n    if (this.state.sort === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n    } else if (this.state.sort === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n    } else if (this.state.sort === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n    } else if (this.state.sort === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n    }\n\n    this.fetchItems(url);\n  };\n\n  handleColoursFilter = (e) => {\n    if (!this.state.colours.includes(e.target.textContent)) {\n      this.state.colours.push(e.target.textContent);\n    } else {\n      let index = this.state.colours.indexOf(e.target.textContent);\n      this.state.colours.splice(index, 1);\n    }\n\n    let url = `${SERVER_HOST}/products?`;\n    if (this.state.category !== \"all items\") {\n      url += `categories=${this.state.category.toLowerCase()}&minprice=${\n        this.state.value[0]\n      }&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    } else {\n      url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    }\n\n    if (this.state.sort === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n    } else if (this.state.sort === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n    } else if (this.state.sort === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n    } else if (this.state.sort === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n    }\n\n    this.fetchItems(url);\n  };\n\n  handleSearch = (e) => {\n    this.setState({ searchQuery: e.target.value });\n    let url = `${SERVER_HOST}/products?`;\n\n    if (this.state.category !== \"all items\") {\n      url += `categories=${this.state.category.toLowerCase()}&q=${\n        e.target.value\n      }&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    } else {\n      this.setState({\n        products: this.state.products.filter((product) =>\n          product.productName.toLowerCase().includes(e.target.value)\n        ),\n      });\n      url += `&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    }\n\n    if (this.state.sort === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n    } else if (this.state.sort === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n    } else if (this.state.sort === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n    } else if (this.state.sort === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n    }\n\n    this.fetchItems(url);\n  };\n\n  handleSort = (e) => {\n    let url = `${SERVER_HOST}/products?`;\n\n    if (this.state.category !== \"all items\") {\n      url += `categories=${this.state.category.toLowerCase()}&productName=${\n        this.state.searchQuery\n      }&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    } else {\n      url += `productName=${this.state.searchQuery}&minprice=${this.state.value[0]}&maxprice=${this.state.value[1]}`;\n      this.state.colours.forEach((colour) => {\n        url += `&colours=${colour}`;\n      });\n    }\n\n    if (e.target.value === \"nameAsc\") {\n      url += `&sortBy=productName&orderBy=1`;\n      this.setState({ sort: e.target.value });\n    } else if (e.target.value === \"nameDesc\") {\n      url += `&sortBy=productName&orderBy=-1`;\n      this.setState({ sort: e.target.value });\n    } else if (e.target.value === \"priceAsc\") {\n      url += `&sortBy=price&orderBy=1`;\n      this.setState({ sort: e.target.value });\n    } else if (e.target.value === \"priceDesc\") {\n      url += `&sortBy=price&orderBy=-1`;\n      this.setState({ sort: e.target.value });\n    } else if (e.target.value === \"\") {\n      this.setState({ sort: \"\" });\n    }\n\n    this.fetchItems(url);\n  };\n\n  render() {\n    return this.state.loading ? (\n      <Spinner animation=\"border\" role=\"status\">\n        <span className=\"visually-hidden\"></span>\n      </Spinner>\n    ) : (\n      <main>\n        <ShopBanner title={this.state.category} />\n        <section>\n          <div className=\"container\">\n            <div className=\"row\">\n              <SideBar\n                onFilter={this.handleCategoryFilter}\n                getAllItems={this.getAllItems}\n                onPriceFilter={this.handlePriceFilter}\n                value={this.state.value}\n                minPrice={this.state.minPrice}\n                maxPrice={this.state.maxPrice}\n                curMinPrice={this.state.value[0]}\n                curMaxPrice={this.state.value[1]}\n                uniqueCategories={this.state.uniqueCategories}\n                onColourFilter={this.handleColoursFilter}\n                uniqueColours={this.state.uniqueColours}\n                colours={this.state.colours}\n                onSearch={this.handleSearch}\n                curCategory={this.state.category}\n              />\n              <ShopGrid\n                products={this.state.products}\n                onSort={this.handleSort}\n              />\n            </div>\n          </div>\n        </section>\n      </main>\n    );\n  }\n}\n\nexport default Shop;\n"]},"metadata":{},"sourceType":"module"}